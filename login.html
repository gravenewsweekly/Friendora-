<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friendora.space - Login</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Friendora.space</h1>
            <p>Connect with friends around the world</p>
        </header>
        
        <main class="form-container">
            <div class="card">
                <form id="loginForm">
                    <h2 class="text-center">Welcome Back</h2>
                    
                    <div class="form-group">
                        <label for="loginUsername">Username or Email</label>
                        <input type="text" id="loginUsername" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" class="form-control" required>
                    </div>
                    
                    <button type="submit" id="loginButton" class="btn btn-block">Log In</button>
                    
                    <div id="loginError" class="error-message mt-2"></div>
                    
                    <div class="text-center mt-3">
                        <p>Don't have an account? <a href="signup.html" class="link">Sign up</a></p>
                        <p><a href="forgot-password.html" class="link">Forgot password?</a></p>
                    </div>
                </form>
            </div>
        </main>
        
        <footer>
            <p>&copy; 2025 Friendora.space. All rights reserved.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            const loginUsername = document.getElementById('loginUsername');
            const loginPassword = document.getElementById('loginPassword');
            const loginButton = document.getElementById('loginButton');
            const loginError = document.getElementById('loginError');
            
            // JSONBin.io configuration
            const BIN_ID = '67e6fe048561e97a50f4cd0e';
            const API_KEY = '$2a$10$SjwPaeKPooM.8FtccKflzOGhqHNe7Vfm/9zjH9q9fH2AkZLZsQf02';
            const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
            
            // Handle form submission
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                loginButton.disabled = true;
                loginButton.textContent = 'Logging in...';
                loginError.textContent = '';
                
                const usernameOrEmail = loginUsername.value.trim();
                const password = loginPassword.value;
                
                try {
                    // Fetch users from JSONBin.io
                    const response = await fetch(API_URL + '/latest', {
                        headers: {
                            'X-Master-Key': API_KEY
                        }
                    });
                    
                    if (!response.ok) throw new Error('Failed to fetch user data');
                    
                    const data = await response.json();
                    const users = data.record.users || [];
                    
                    // Find matching user
                    const user = users.find(u => 
                        (u.username.toLowerCase() === usernameOrEmail.toLowerCase() || 
                         u.email.toLowerCase() === usernameOrEmail.toLowerCase()) &&
                        u.password === password // Note: In production, compare hashed passwords
                    );
                    
                    if (user) {
                        // Store user session (insecure - for demo only)
                        localStorage.setItem('currentUser', JSON.stringify({
                            username: user.username,
                            email: user.email
                        }));
                        
                        // Redirect to homepage
                        window.location.href = 'index.html';
                    } else {
                        loginError.textContent = 'Invalid username/email or password';
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    loginError.textContent = 'Failed to login. Please try again later.';
                } finally {
                    loginButton.disabled = false;
                    loginButton.textContent = 'Log In';
                }
            });
            
            // Check if user is already logged in
            function checkLoggedIn() {
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    window.location.href = 'index.html';
                }
            }
            
            checkLoggedIn();
        });
    </script>
</body>
</html>
